<html>
<!-- Nidm Viewer, for Server
     @vsoch, Poldracklab <3 -->
<head>
    <title>NIDM Viewer</title>
    <!--[TAG_JQUERY_TAG]--><script src="https://rawgithub.com/vsoch/nidmviewer/master/js/jquery-2.1.4.min.js"></script>
    <!--[TAG_BOOTSTRAPCSS_TAG]--><link rel="stylesheet" type="text/css" href="https://rawgithub.com/vsoch/nidmviewer/master/css/bootstrap.min.css">
    <!--[TAG_BOOTSTRAPJS_TAG]--><script src="https://rawgithub.com/vsoch/nidmviewer/master/js/bootstrap.min.js"></script>
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/script.js"></script>
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/table.js"></script>
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/scribl.min.js"></script>
    <script src="https://rawgithub.com/vsoch/nidmviewer/master/js/bootstrap-table.js"></script>
    <link href="https://rawgithub.com/vsoch/nidmviewer/master/css/fresh-bootstrap-table.css" rel="stylesheet" />
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://rawgithub.com/vsoch/font-brain/master/font-brain/font-brain.css" rel="stylesheet">
    <!--[TAG_PAPAYACSS_TAG]--><link rel="stylesheet" type="text/css" href="https://rawgithub.com/vsoch/nidmviewer/master/css/papaya.css" /> <!--version=0.8&build=910-->
    <!--[TAG_PAPAYAJS_TAG]--><script type="text/javascript" src="https://rawgithub.com/vsoch/nidmviewer/master/js/papaya.js"></script> <!--version=0.8&build=910,beta-->
</head>

<body>

    <div class="row">

            <!-- Buttons! -->
            <div id="button_zone">

                <div class="float-left-wrapper">

<!-- NIDM Selection -->
<!--[TAG_NIDMSELECTBUTTON_TAG]--><button class="btn btn-default">
<!--[TAG_NIDMSELECTBUTTON_TAG]--><li class="dropdown">
<!--[TAG_NIDMSELECTBUTTON_TAG]--><a data-toggle="dropdown" class="dropdown-toggle" href="#">Select NIDM <b class="caret"></b></a>
<!--[TAG_NIDMSELECTBUTTON_TAG]--><ul class="dropdown-menu" id="nidm_selection">
<!--[TAG_NIDMSELECTBUTTON_TAG]--></ul>
<!--[TAG_NIDMSELECTBUTTON_TAG]--></li>
<!--[TAG_NIDMSELECTBUTTON_TAG]--></button>

                    <!-- View image buttons will be appended here -->
                    <button class="btn btn-default">
                        <li class="dropdown">
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#">BRAIN <i class="fb icon-sagittal"></i><b class="caret"></b></a>
                                <ul class="dropdown-menu" id="nidm_images">
                                </ul>
                        </li>
                    </button>

                </div>

                <div class="float-right-wrapper">

                    <a href="http://www.github.com/vsoch/nidmviewer" target="_blank">
                        <button class="btn btn-default circle"><i class="fa fa-github"></i></button>
                    </a>
            </div>
        </div>


<div class="row">

    <!-- If excursion set is empty (regardless of peaks listed in the .ttl file) show "No suprathreshold voxels" instead of the table and the nifiti viewer. (this will happen if the analysis did not return any statistically significant results)-->
    <div class="col-md-12" id="empty" style="position:relative;padding-left:300px;padding-top:70px" class="hidden">
        <h1 style="color:white">No suprathreshold voxels</h1>
    </div>

    <!-- Left sidebar region for tables -->
    <div id="bluetable" class="col-md-6">

        <!-- Tables for nidm will be dynamically rendered here -->
        <div class="row" id="tablerow">
        </div>
    </div>

    <!-- Papaya viewer window -->
    <div id="pappy" class="col-md-6">

    <script type="text/javascript" src="https://rawgithub.com/vsoch/nidmviewer/master/js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="https://rawgithub.com/vsoch/nidmviewer/master/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://rawgithub.com/vsoch/nidmviewer/master/js/bootstrap-table.js"></script>
    <script type="text/javascript">

     var peaks = {'/home/vanessa/Documents/Dropbox/Code/nidm/nidm-viewer/examples/fsl/nidm.ttl': [{'pvalue_uncorrected': '0.000301790624609', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-17.5', 'x': '20.9', 'z_score': '3.43', 'y': '31.5', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/88b653a0-1449-47bb-a319-9195e146f874', 'coord_name': 'Coordinate 0001_3'}, {'pvalue_uncorrected': '3.07593950311e-11', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-8.19', 'x': '-55.5', 'z_score': '6.54', 'y': '0.362', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/6a35f5a4-364e-46f8-a5b6-3f77ccf23ff0', 'coord_name': 'Coordinate 0002_6'}, {'pvalue_uncorrected': '4.99600361081e-15', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-0.366', 'x': '-65.0', 'z_score': '7.74', 'y': '-23.6', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/353e2155-33de-48ae-a564-6a83a1a61e6a', 'coord_name': 'Coordinate 0002_1'}, {'pvalue_uncorrected': '4.07408045586e-05', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-17.8', 'x': '25.5', 'z_score': '3.94', 'y': '39.5', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/141714b9-efba-4b76-89c8-58e6236cb269', 'coord_name': 'Coordinate 0001_1'}, {'pvalue_uncorrected': '6.00874905388e-12', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-2.87', 'x': '55.4', 'z_score': '6.78', 'y': '-13.0', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/af0da9f6-7a59-4a7c-9b6a-c57522a3ecc6', 'coord_name': 'Coordinate 0002_2'}, {'pvalue_uncorrected': '0.000967603213218', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-17.1', 'x': '3.07', 'z_score': '3.1', 'y': '31.7', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/a2385c7a-fe38-46c1-8701-d4e12ff81900', 'coord_name': 'Coordinate 0001_4'}, {'pvalue_uncorrected': '9.73121583314e-12', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '6.5', 'x': '-51.9', 'z_score': '6.71', 'y': '-31.7', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/1ef64c0f-e103-4d8e-bfec-6f485c0fd856', 'coord_name': 'Coordinate 0002_3'}, {'pvalue_uncorrected': '1.04209973983e-11', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-17.1', 'x': '55.9', 'z_score': '6.7', 'y': '3.06', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/5e14be97-992c-4d22-8191-a1cbc179d388', 'coord_name': 'Coordinate 0002_4'}, {'pvalue_uncorrected': '0.00180714378081', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-10.2', 'x': '11.7', 'z_score': '2.91', 'y': '23.6', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/36bb1942-6957-426b-870d-83194013fea9', 'coord_name': 'Coordinate 0001_5'}, {'pvalue_uncorrected': '2.87685431033e-11', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-1.09', 'x': '-55.7', 'z_score': '6.55', 'y': '-7.65', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/e8119f57-684e-4240-b049-ead0f9ed48f3', 'coord_name': 'Coordinate 0002_5'}, {'pvalue_uncorrected': '0.000270087693963', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-18.6', 'x': '39.2', 'z_score': '3.46', 'y': '55.4', 'excsetmap_location': 'fsl/ExcursionSet_T002.nii.gz', 'original_path': 'file://./ExcursionSet_T002.nii.gz', 'exc_set': 'http://iri.nidash.org/2f8fe688-abe9-465c-bedd-fbe50c3a5206', 'coordinate_id': 'http://iri.nidash.org/f46f85aa-8c21-4ffc-b866-5d5c379a3baa', 'coord_name': 'Coordinate 0001_2'}, {'pvalue_uncorrected': '8.85440609721e-11', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-13.0', 'x': '-3.77', 'z_score': '6.38', 'y': '-80.4', 'excsetmap_location': 'fsl/ExcursionSet_T001.nii.gz', 'original_path': 'file://./ExcursionSet_T001.nii.gz', 'exc_set': 'http://iri.nidash.org/59648721-73fe-42f4-92bf-8ca993fe7d03', 'coordinate_id': 'http://iri.nidash.org/62f3071d-6fb9-479e-af8c-f4b95c3d0c3a', 'coord_name': 'Coordinate 0001_5'}, {'pvalue_uncorrected': '4.87987428244e-12', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '8.27', 'x': '-30.9', 'z_score': '6.81', 'y': '-92.1', 'excsetmap_location': 'fsl/ExcursionSet_T001.nii.gz', 'original_path': 'file://./ExcursionSet_T001.nii.gz', 'exc_set': 'http://iri.nidash.org/59648721-73fe-42f4-92bf-8ca993fe7d03', 'coordinate_id': 'http://iri.nidash.org/06543363-c9f4-4625-8c31-85493c36744d', 'coord_name': 'Coordinate 0001_3'}, {'pvalue_uncorrected': '1.92488691653e-10', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-5.96', 'x': '4.83', 'z_score': '6.26', 'y': '-92.6', 'excsetmap_location': 'fsl/ExcursionSet_T001.nii.gz', 'original_path': 'file://./ExcursionSet_T001.nii.gz', 'exc_set': 'http://iri.nidash.org/59648721-73fe-42f4-92bf-8ca993fe7d03', 'coordinate_id': 'http://iri.nidash.org/ba5df904-7193-4765-a3a3-38320c3d6058', 'coord_name': 'Coordinate 0001_6'}, {'pvalue_uncorrected': '1.37445610449e-12', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '8.03', 'x': '-8.72', 'z_score': '6.99', 'y': '-96.4', 'excsetmap_location': 'fsl/ExcursionSet_T001.nii.gz', 'original_path': 'file://./ExcursionSet_T001.nii.gz', 'exc_set': 'http://iri.nidash.org/59648721-73fe-42f4-92bf-8ca993fe7d03', 'coordinate_id': 'http://iri.nidash.org/71ba2b8e-31a0-4027-9252-35a15906c451', 'coord_name': 'Coordinate 0001_2'}, {'pvalue_uncorrected': '2.08388861722e-13', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '-5.73', 'x': '-8.52', 'z_score': '7.25', 'y': '-92.4', 'excsetmap_location': 'fsl/ExcursionSet_T001.nii.gz', 'original_path': 'file://./ExcursionSet_T001.nii.gz', 'exc_set': 'http://iri.nidash.org/59648721-73fe-42f4-92bf-8ca993fe7d03', 'coordinate_id': 'http://iri.nidash.org/f654a391-9ab9-46dc-a156-51ae1e7bbda5', 'coord_name': 'Coordinate 0001_1'}, {'pvalue_uncorrected': '8.48321413116e-12', 'statmap_type': 'http://purl.obolibrary.org/obo/STATO_0000376', 'z': '7.64', 'x': '13.5', 'z_score': '6.73', 'y': '-96.7', 'excsetmap_location': 'fsl/ExcursionSet_T001.nii.gz', 'original_path': 'file://./ExcursionSet_T001.nii.gz', 'exc_set': 'http://iri.nidash.org/59648721-73fe-42f4-92bf-8ca993fe7d03', 'coordinate_id': 'http://iri.nidash.org/13cd636c-2252-49bd-8ffc-0600adc188b6', 'coord_name': 'Coordinate 0001_4'}]};
     filename_key = "statmap";
     location_key = "excsetmap_location";
     var column_names = {'/home/vanessa/Documents/Dropbox/Code/nidm/nidm-viewer/examples/fsl/nidm.ttl': ['excsetmap_location', 'z_score', 'pvalue_uncorrected', 'coord_name', 'x', 'y', 'z']};
     var empty_images = {'fsl/ExcursionSet_T001.nii.gz': 0, 'fsl/ExcursionSet_T002.nii.gz': 0};

     var cx;
     var params = [];
     params["worldSpace"] = true;
     params["expandable"] = false;
     params["combineParametric"] = true;
     params["showControls"] = false;
     params["luts"] = [{"name":"PuBu", "data":[[0,1,0.968627,0.984314],[0.125,0.92549,0.905882,0.94902],[0.25,0.815686,0.819608,0.901961],[0.375,0.65098,0.741176,0.858824],[0.5,0.454902,0.662745,0.811765],[0.625,0.211765,0.564706,0.752941],[0.75,0.0196078,0.439216,0.690196],[0.875,0.0156863,0.352941,0.552941],[1,0.00784314,0.219608,0.345098]]},
     {"name":"OrRd", "data":[[0,1,0.968627,0.92549],[0.125,0.996078,0.909804,0.784314],[0.25,0.992157,0.831373,0.619608],[0.375,0.992157,0.733333,0.517647],[0.5,0.988235,0.552941,0.34902],[0.625,0.937255,0.396078,0.282353],[0.75,0.843137,0.188235,0.121569],[0.875,0.701961,0,0],[1,0.498039,0,0]]}];
     params["https://rawgit.com/vsoch/nidmviewer/master/nidmviewer/data/MNI152_T1_2mm_brain.nii.gz"] = {"parametric": true,  "min":0, "alpha":"0.75", "symmetric":true};
     params["kioskMode"] = true;    


// Function to add / remove image from viewer
function viewimage(file) {

     // Tag canvas, and show export button
     $($("canvas")[0]).attr("id","papaya-canvas")
     $("#export").show()

     // Reset viewer and load new images
     papayaContainers[0].viewer.resetViewer(0,params);
     papayaContainers[0].toolbar.updateImageButtons();
     papayaContainers[0].viewer.loadBaseImage(["https://rawgit.com/vsoch/nidmviewer/master/nidmviewer/data/MNI152_T1_2mm_brain.nii.gz"],true)
     params[file] = {"parametric": true,  "min":0, "lut":"OrRd", "negative_lut":"PuBu", "alpha":"0.75", "symmetric":true};
     setTimeout(function(){
             papayaContainers[0].viewer.loadOverlay([file],true);
     }, 500);
       
}

</script>

	<div class="papaya" data-params="params"></div>

        <!-- View svg modal -->
        <div class="modal" id="exportmodal">
            <div class="modal-admin">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">x</span></button>
                        <h4 class="modal-title">Right click to Save As</h4>
                    </div>
                    <div class="modal-body">
                        <div id="svgexport"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->


	
        </div>
    </div>     
</div>


    <script type="text/javascript">        
            
        $().ready(function(){

	     // Generate initial table, and buttons for nidm
	     nidm_files = []
	     for (var nidm in peaks) {
		 if (peaks.hasOwnProperty(nidm)) {
		     nidm_files.push(nidm)
                     console.log(nidm);
                     $("#nidm_selection").append("<li><a href='#' onclick=load_nidm(\""+ nidm +"\")>" + nidm + "</a></li>") //[TAG_NIDMSELECTBUTTON_TAG]
		 }
	     }

             // Load first nidm into viewer
             nidm = nidm_files[0]
             load_nidm(nidm)
             $('.dropdown-toggle').dropdown()

         });

       
    </script>

<script>
$(function () {
    $(".search").css("width","160px")
    $('button[name=toggle]').css("height","40px")
    $("#export").hide()
    $("#export").css("margin-left",30)
});
</script>
<!--[TAG_ROBOTOFONT_TAG]--><link href="http://fonts.googleapis.com/css?family=Roboto:300" rel="stylesheet" type="text/css">
<!--[TAG_ALLSTYLE_TAG]--><link href="https://rawgithub.com/vsoch/nidmviewer/master/css/style.css" rel="stylesheet" type="text/css">
</body></html>


